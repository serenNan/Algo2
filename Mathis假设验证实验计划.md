# Dr. Matt Mathis å‡è®¾éªŒè¯å®éªŒè®¡åˆ’

## ğŸš€ å¿«é€Ÿå¼€å§‹ (ç½‘ç»œå‘½åç©ºé—´æ–¹æ¡ˆ)

**ç¯å¢ƒ**: çº¯ Linux ç¯å¢ƒ,æ— éœ€è™šæ‹Ÿæœº

**æ‰§è¡Œæ­¥éª¤**:
```bash
# 1. ç¼–è¯‘ FoggyTCP
cd /home/serennan/work/algo2/foggytcp2/foggytcp
make foggy

# 2. å‡†å¤‡æµ‹è¯•æ–‡ä»¶
mkdir -p ../testdata
dd if=/dev/urandom of=../testdata/test_1mb.bin bs=1M count=1

# 3. è®¾ç½®ç½‘ç»œå‘½åç©ºé—´
cd ../scripts
sudo ./setup_netns.sh

# 4. éªŒè¯ç½‘ç»œè¿é€šæ€§
sudo ip netns exec ns_client ping -c 3 10.0.1.1

# 5. è¿è¡Œå®éªŒ (çº¦ 1-2 å°æ—¶)
sudo python3 experiment_mathis.py

# 6. å®éªŒå®Œæˆåæ¸…ç†
sudo ./cleanup_netns.sh

# 7. åˆ†ææ•°æ®
python3 analyze_mathis.py
```

**æ³¨æ„**: éœ€è¦ sudo æƒé™å’Œ tcconfig å·¥å…· (`pip install tcconfig`)

---

## ä¸€ã€å®éªŒç›®æ ‡

éªŒè¯ TCP Reno ååé‡æ–¹ç¨‹:

**throughput = (MSS/RTT) Ã— (C/âˆšp)**

å…¶ä¸­:
- **MSS** â‰ˆ 1360 å­—èŠ‚ (1400 - å¤´éƒ¨å¤§å°)
- **RTT** = å¾€è¿”æ—¶å»¶ (é€šè¿‡ tcconfig è®¾ç½®)
- **p** = ä¸¢åŒ…æ¦‚ç‡
- **C** = å¸¸æ•° (éœ€é€šè¿‡çº¿æ€§å›å½’ç¡®å®š)

**éªŒè¯ç›®æ ‡**:
1. é€šè¿‡çº¿æ€§å›å½’æ±‚å‡ºå¸¸æ•° C çš„å€¼
2. è®¡ç®— 1/âˆšp ä¸å®æµ‹ååé‡ä¹‹é—´çš„çš®å°”é€Šç›¸å…³ç³»æ•°
3. åˆ¤æ–­å®éªŒæ•°æ®æ˜¯å¦æ”¯æŒ Mathis å‡è®¾

---

## äºŒã€å®éªŒç¯å¢ƒ

### 2.1 é¡¹ç›®ä¿¡æ¯
- **é¡¹ç›®è·¯å¾„**: `/home/serennan/work/algo2/foggytcp2/foggytcp`
- **å‘é€ç«¯**: `client` (è¯»å–æ–‡ä»¶å¹¶é€šè¿‡ FoggyTCP å‘é€)
- **æ¥æ”¶ç«¯**: `server` (æ¥æ”¶æ–‡ä»¶å¹¶è¾“å‡ºä¼ è¾“æ—¶é—´)
- **åè®®å®ç°**: TCP Reno with Fast Retransmit

### 2.2 ç½‘ç»œé…ç½®

**âœ… é‡‡ç”¨æ–¹æ¡ˆ: Linux ç½‘ç»œå‘½åç©ºé—´**

ç”±äºåœ¨çº¯ Linux ç¯å¢ƒä¸‹,æœ¬åœ°å›ç¯æ¥å£ (127.0.0.1) æ— æ³•è¢« tcconfig æ§åˆ¶ç½‘ç»œå‚æ•°,å› æ­¤é‡‡ç”¨ **ç½‘ç»œå‘½åç©ºé—´ (Network Namespace)** æ–¹æ¡ˆæ¥éš”ç¦»ç½‘ç»œç¯å¢ƒã€‚

**ç½‘ç»œæ‹“æ‰‘**:
- åˆ›å»ºä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´: `ns_server` å’Œ `ns_client`
- ä½¿ç”¨è™šæ‹Ÿä»¥å¤ªç½‘æ¥å£å¯¹ (veth pair): `veth_server` <-> `veth_client`
- IP åœ°å€åˆ†é…:
  - Server: 10.0.1.1/24 (åœ¨ ns_server å‘½åç©ºé—´)
  - Client: 10.0.1.2/24 (åœ¨ ns_client å‘½åç©ºé—´)

**ç½‘ç»œå‚æ•°æ§åˆ¶**:
- **å·¥å…·**: tcconfig (`tcset`, `tcshow`, `tcdel`)
- **æ§åˆ¶ä½ç½®**: åœ¨ `ns_client` å‘½åç©ºé—´çš„ `veth_client` æ¥å£ä¸Šè®¾ç½®
- **å›ºå®šå‚æ•°**:
  - å¸¦å®½: 10 Mbps
  - å»¶è¿Ÿ: 20 ms (å•å‘å»¶è¿Ÿ,RTT = 40 ms)
- **å˜é‡å‚æ•°**:
  - ä¸¢åŒ…ç‡ p: å¤šä¸ªä¸åŒå€¼

**ä¼˜åŠ¿**:
- âœ… ç½‘ç»œå‚æ•°å¯ç²¾ç¡®æ§åˆ¶ (tcconfig åœ¨è™šæ‹Ÿæ¥å£ä¸Šç”Ÿæ•ˆ)
- âœ… ç¯å¢ƒéš”ç¦»,ä¸å—ä¸»æœºå…¶ä»–ç½‘ç»œæµé‡å¹²æ‰°
- âœ… æ— éœ€è™šæ‹Ÿæœº,èµ„æºå ç”¨å°‘
- âœ… Linux åŸç”ŸåŠŸèƒ½,æ— éœ€å®‰è£…é¢å¤–è½¯ä»¶

### 2.3 æµ‹è¯•æ–‡ä»¶
å»ºè®®æ–‡ä»¶å¤§å°: **1MB - 10MB**
- ç¡®ä¿ä¼ è¾“æ—¶é—´ â‰¥ 3 ç§’
- é¿å…è¿‡çŸ­å¯¼è‡´æµ‹é‡è¯¯å·®
- æ–‡ä»¶å­˜æ”¾ä½ç½®: `foggytcp2/testdata/`

---

## ä¸‰ã€å®éªŒè®¾è®¡

### 3.1 ä¸¢åŒ…ç‡é€‰æ‹©

å»ºè®®æµ‹è¯•ä»¥ä¸‹ä¸¢åŒ…ç‡å€¼:

| åºå· | ä¸¢åŒ…ç‡ p | 1/âˆšp | è¯´æ˜ |
|-----|---------|------|------|
| 1 | 0.01% (0.0001) | 100 | æä½ä¸¢åŒ… |
| 2 | 0.05% (0.0005) | 44.72 | ä½ä¸¢åŒ… |
| 3 | 0.1% (0.001) | 31.62 | ä¸­ä½ä¸¢åŒ… |
| 4 | 0.5% (0.005) | 14.14 | ä¸­ç­‰ä¸¢åŒ… |
| 5 | 1% (0.01) | 10 | ä¸­é«˜ä¸¢åŒ… |
| 6 | 2% (0.02) | 7.07 | é«˜ä¸¢åŒ… |
| 7 | 5% (0.05) | 4.47 | æé«˜ä¸¢åŒ… |

### 3.2 é‡å¤æ¬¡æ•°
- æ¯ä¸ªä¸¢åŒ…ç‡: **10 æ¬¡é‡å¤å®éªŒ**
- æ€»å®éªŒæ¬¡æ•°: **7 Ã— 10 = 70 æ¬¡**

### 3.3 æ•°æ®è®°å½•æ ¼å¼

CSV æ–‡ä»¶æ ¼å¼ (`mathis_data.csv`):
```csv
loss_rate,trial,duration_ms,file_size_bytes,throughput_mbps,1_over_sqrt_p
0.0001,1,2345,1048576,3.57,100.0
0.0001,2,2398,1048576,3.50,100.0
...
```

å­—æ®µè¯´æ˜:
- `loss_rate`: ä¸¢åŒ…ç‡ (å°æ•°å½¢å¼)
- `trial`: è¯•éªŒç¼–å· (1-10)
- `duration_ms`: ä¼ è¾“æ—¶é•¿ (æ¯«ç§’)
- `file_size_bytes`: æ–‡ä»¶å¤§å° (å­—èŠ‚)
- `throughput_mbps`: ååé‡ (Mbps)
- `1_over_sqrt_p`: 1/âˆšp å€¼

---

## å››ã€å®éªŒæ­¥éª¤

### é˜¶æ®µ 1: ç¯å¢ƒå‡†å¤‡ (é¢„è®¡ 30 åˆ†é’Ÿ)

#### 1.1 ç¼–è¯‘é¡¹ç›®
```bash
cd /home/serennan/work/algo2/foggytcp2/foggytcp
make clean
make foggy
```

éªŒè¯ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶:
- `./server`
- `./client`

#### 1.2 åˆ›å»ºç›®å½•ç»“æ„
```bash
mkdir -p foggytcp2/scripts      # å®éªŒè„šæœ¬
mkdir -p foggytcp2/testdata     # æµ‹è¯•æ–‡ä»¶
mkdir -p foggytcp2/results      # å®éªŒç»“æœ
```

#### 1.3 è®¾ç½®ç½‘ç»œå‘½åç©ºé—´ â­ **æ–°å¢**
```bash
cd /home/serennan/work/algo2/foggytcp2/scripts

# è¿è¡Œç½‘ç»œå‘½åç©ºé—´è®¾ç½®è„šæœ¬
sudo ./setup_netns.sh
```

**è„šæœ¬åŠŸèƒ½**:
- åˆ›å»º `ns_server` å’Œ `ns_client` ä¸¤ä¸ªç½‘ç»œå‘½åç©ºé—´
- åˆ›å»ºå¹¶é…ç½®è™šæ‹Ÿç½‘ç»œæ¥å£å¯¹ `veth_server` <-> `veth_client`
- è®¾ç½® IP åœ°å€: 10.0.1.1 (server) å’Œ 10.0.1.2 (client)
- éªŒè¯ç½‘ç»œè¿é€šæ€§

**éªŒè¯ç½‘ç»œé…ç½®**:
```bash
# æŸ¥çœ‹å‘½åç©ºé—´åˆ—è¡¨
ip netns list

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
sudo ip netns exec ns_client ping -c 3 10.0.1.1
```

#### 1.4 å‡†å¤‡æµ‹è¯•æ–‡ä»¶
```bash
# åˆ›å»º 1MB æµ‹è¯•æ–‡ä»¶ (ä¼ è¾“æ›´å¿«,ä¾¿äºè°ƒè¯•)
dd if=/dev/urandom of=/home/serennan/work/algo2/foggytcp2/testdata/test_1mb.bin bs=1M count=1
```

#### 1.5 å®‰è£… Python ä¾èµ–
```bash
# ä½¿ç”¨ conda ç¯å¢ƒ
conda activate base  # æˆ–å…¶ä»–åˆé€‚çš„ç¯å¢ƒ
pip install numpy scipy matplotlib pandas tcconfig
```

---

### é˜¶æ®µ 2: å®éªŒè„šæœ¬å¼€å‘ âœ… **å·²å®Œæˆ**

#### 2.1 å®éªŒæ‰§è¡Œè„šæœ¬

**æ–‡ä»¶**: `foggytcp2/scripts/experiment_mathis.py` âœ… **å·²å‡†å¤‡å¥½**

**åŠŸèƒ½**:
1. è‡ªåŠ¨åŒ–é…ç½®ç½‘ç»œå‚æ•° (åœ¨ ns_client å‘½åç©ºé—´ä¸­ä½¿ç”¨ tcconfig)
2. åœ¨ç½‘ç»œå‘½åç©ºé—´ä¸­å¯åŠ¨ server å’Œ client è¿›ç¨‹
3. æå–ä¼ è¾“æ—¶é—´å¹¶è®¡ç®—ååé‡
4. ä¿å­˜æ•°æ®åˆ° CSV æ–‡ä»¶

**å…³é”®ç‰¹æ€§**:
- âœ… ä½¿ç”¨ç½‘ç»œå‘½åç©ºé—´éš”ç¦»ç½‘ç»œç¯å¢ƒ
- âœ… Server åœ¨ `ns_server` å‘½åç©ºé—´è¿è¡Œ (IP: 10.0.1.1)
- âœ… Client åœ¨ `ns_client` å‘½åç©ºé—´è¿è¡Œ (IP: 10.0.1.2)
- âœ… tcconfig åœ¨ `veth_client` æ¥å£ä¸Šè®¾ç½®ç½‘ç»œå‚æ•°

**æ ¸å¿ƒé…ç½®** (å·²æ›´æ–°ä¸ºç½‘ç»œå‘½åç©ºé—´):
```python
# ç½‘ç»œå‘½åç©ºé—´é…ç½®
NS_SERVER = "ns_server"
NS_CLIENT = "ns_client"
SERVER_IP = "10.0.1.1"  # æœåŠ¡å™¨åœ¨ ns_server ä¸­çš„ IP
INTERFACE = "veth_client"  # client å‘½åç©ºé—´ä¸­çš„è™šæ‹Ÿæ¥å£

# ä¸¢åŒ…ç‡åˆ—è¡¨
LOSS_RATES = [0.0001, 0.0005, 0.001, 0.005, 0.01, 0.02, 0.05]
TRIALS_PER_LOSS = 10

# å¯åŠ¨æœåŠ¡å™¨ (åœ¨ ns_server å‘½åç©ºé—´)
def start_server(output_file):
    cmd = ["sudo", "ip", "netns", "exec", NS_SERVER,
           str(SERVER_BIN), SERVER_IP, str(SERVER_PORT), str(output_file)]
    return subprocess.Popen(cmd, ...)

# è¿è¡Œå®¢æˆ·ç«¯ (åœ¨ ns_client å‘½åç©ºé—´)
def run_client_and_get_duration(server_proc):
    cmd = ["sudo", "ip", "netns", "exec", NS_CLIENT,
           str(CLIENT_BIN), SERVER_IP, str(SERVER_PORT), str(TEST_FILE)]
    result = subprocess.run(cmd, ...)

# è®¾ç½®ç½‘ç»œå‚æ•° (åœ¨ ns_client å‘½åç©ºé—´çš„ veth_client æ¥å£)
def set_network_config(loss_rate):
    cmd = ["sudo", "ip", "netns", "exec", NS_CLIENT,
           "tcset", INTERFACE, "--rate", BANDWIDTH,
           "--delay", DELAY, "--loss", f"{loss_percent}%"]
    subprocess.run(cmd, ...)
```

**æ³¨æ„äº‹é¡¹**:
- âœ… éœ€è¦ sudo æƒé™ (ç”¨äºç½‘ç»œå‘½åç©ºé—´å’Œ tcconfig)
- âœ… å®éªŒå‰å¿…é¡»å…ˆè¿è¡Œ `setup_netns.sh` åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
- âœ… æ¯æ¬¡å®éªŒåè‡ªåŠ¨æ¸…ç†ç½‘ç»œé™åˆ¶,é¿å…ç´¯ç§¯
- âœ… Server è¾“å‡ºæ ¼å¼: `Complete transmission in X ms`
- âœ… åŒ…å«å‰ç½®æ¡ä»¶æ£€æŸ¥ (å‘½åç©ºé—´ã€å¯æ‰§è¡Œæ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶)

---

#### 2.2 æ•°æ®åˆ†æè„šæœ¬

**æ–‡ä»¶**: `foggytcp2/scripts/analyze_mathis.py`

**åŠŸèƒ½**:
1. åŠ è½½å®éªŒæ•°æ®
2. è®¡ç®—ç»Ÿè®¡é‡(å‡å€¼ã€æ ‡å‡†å·®)
3. çº¿æ€§å›å½’åˆ†æ
4. è®¡ç®—ç›¸å…³ç³»æ•°
5. ç”Ÿæˆå¯è§†åŒ–å›¾è¡¨

**åˆ†ææµç¨‹**:

##### æ­¥éª¤ 1: æ•°æ®é¢„å¤„ç†
```python
import pandas as pd
import numpy as np

# è¯»å–æ•°æ®
df = pd.read_csv('../results/mathis_data.csv')

# æŒ‰ä¸¢åŒ…ç‡åˆ†ç»„,è®¡ç®—ç»Ÿè®¡é‡
grouped = df.groupby('loss_rate').agg({
    'throughput_mbps': ['mean', 'std'],
    '1_over_sqrt_p': 'first'
})
```

##### æ­¥éª¤ 2: çº¿æ€§å›å½’
```python
from scipy import stats

# æå– x, y æ•°æ®
x = grouped['1_over_sqrt_p'].values  # 1/âˆšp
y = grouped['throughput_mbps']['mean'].values  # å¹³å‡ååé‡

# çº¿æ€§å›å½’
slope, intercept, r_value, p_value, std_err = stats.linregress(x, y)

# è®¡ç®—å¸¸æ•° C
MSS = 1360  # bytes
RTT = 0.04  # 40ms = 0.04s
C = (slope * RTT) / (MSS / 1e6)  # è½¬æ¢ä¸º Mbps å•ä½

print(f"å›å½’æ–œç‡: {slope:.4f}")
print(f"æˆªè·: {intercept:.4f}")
print(f"å¸¸æ•° C: {C:.4f}")
print(f"RÂ²: {r_value**2:.4f}")
```

##### æ­¥éª¤ 3: çš®å°”é€Šç›¸å…³ç³»æ•°
```python
# ä½¿ç”¨æ‰€æœ‰æ•°æ®ç‚¹(ä¸ä»…ä»…æ˜¯å¹³å‡å€¼)
all_x = df['1_over_sqrt_p'].values
all_y = df['throughput_mbps'].values

pearson_r, pearson_p = stats.pearsonr(all_x, all_y)
print(f"çš®å°”é€Šç›¸å…³ç³»æ•°: {pearson_r:.4f}")
print(f"P å€¼: {pearson_p:.6f}")
```

##### æ­¥éª¤ 4: å¯è§†åŒ–
```python
import matplotlib.pyplot as plt

plt.figure(figsize=(10, 6))

# æ•£ç‚¹å›¾ - æ‰€æœ‰æ•°æ®ç‚¹
plt.scatter(df['1_over_sqrt_p'], df['throughput_mbps'],
            alpha=0.3, s=30, label='å®éªŒæ•°æ®ç‚¹')

# å¹³å‡å€¼æŠ˜çº¿
plt.plot(grouped['1_over_sqrt_p'], grouped['throughput_mbps']['mean'],
         'o-', linewidth=2, markersize=8, label='å¹³å‡ååé‡')

# å›å½’çº¿
x_line = np.linspace(x.min(), x.max(), 100)
y_line = slope * x_line + intercept
plt.plot(x_line, y_line, 'r--', linewidth=2,
         label=f'å›å½’çº¿: y = {slope:.4f}x + {intercept:.4f}')

# æ ‡æ³¨
plt.xlabel('1/âˆšp', fontsize=14)
plt.ylabel('ååé‡ (Mbps)', fontsize=14)
plt.title('Dr. Matt Mathis å‡è®¾éªŒè¯\nTCP Reno ååé‡ vs 1/âˆšp', fontsize=16)
plt.legend(fontsize=12)
plt.grid(True, alpha=0.3)

# æ·»åŠ æ–‡æœ¬æ¡†æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
textstr = f'C = {C:.4f}\nRÂ² = {r_value**2:.4f}\nPearson r = {pearson_r:.4f}'
plt.text(0.05, 0.95, textstr, transform=plt.gca().transAxes,
         fontsize=12, verticalalignment='top',
         bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.5))

plt.tight_layout()
plt.savefig('../results/mathis_plot.png', dpi=300)
plt.show()
```

---

### é˜¶æ®µ 3: æ‰§è¡Œå®éªŒ (é¢„è®¡ 1-2 å°æ—¶)

#### 3.1 è¿è¡Œå®éªŒè„šæœ¬

**å‰ç½®æ£€æŸ¥**:
```bash
# ç¡®è®¤ç½‘ç»œå‘½åç©ºé—´å·²åˆ›å»º
ip netns list
# åº”è¯¥çœ‹åˆ°: ns_server å’Œ ns_client

# æµ‹è¯•ç½‘ç»œè¿é€šæ€§
sudo ip netns exec ns_client ping -c 3 10.0.1.1
```

**è¿è¡Œå®éªŒ**:
```bash
cd /home/serennan/work/algo2/foggytcp2/scripts
sudo python3 experiment_mathis.py
```

**å®éªŒæµç¨‹**:
1. è„šæœ¬ä¼šè‡ªåŠ¨æ£€æŸ¥å‰ç½®æ¡ä»¶ (å‘½åç©ºé—´ã€å¯æ‰§è¡Œæ–‡ä»¶ã€æµ‹è¯•æ–‡ä»¶)
2. æŒ‰é¡ºåºæµ‹è¯• 7 ä¸ªä¸¢åŒ…ç‡,æ¯ä¸ªé‡å¤ 10 æ¬¡ (å…± 70 æ¬¡å®éªŒ)
3. æ¯æ¬¡å®éªŒ:
   - åœ¨ `ns_client` ä¸­è®¾ç½®ç½‘ç»œå‚æ•° (tcconfig)
   - åœ¨ `ns_server` ä¸­å¯åŠ¨ server è¿›ç¨‹
   - åœ¨ `ns_client` ä¸­è¿è¡Œ client è¿›ç¨‹
   - è®°å½•ä¼ è¾“æ—¶é•¿å’Œååé‡åˆ° CSV
   - æ¸…ç†è¿›ç¨‹å’Œç½‘ç»œé™åˆ¶

**ç›‘æ§è¦ç‚¹**:
- âœ… è§‚å¯Ÿæ¯æ¬¡ä¼ è¾“æ˜¯å¦æˆåŠŸå®Œæˆ
- âœ… æ£€æŸ¥æ˜¯å¦æœ‰å¡ä½çš„æƒ…å†µ (è¶…æ—¶è®¾ç½®ä¸º 5 åˆ†é’Ÿ)
- âœ… æŸ¥çœ‹å®æ—¶è¿›åº¦: "æˆåŠŸ: X | å¤±è´¥: Y"
- âœ… è®°å½•å¤±è´¥çš„è¯•éªŒ,å¿…è¦æ—¶é‡æ–°è¿è¡Œ

#### 3.2 ä¸­é—´æ£€æŸ¥
æ¯å®Œæˆä¸€ç»„ä¸¢åŒ…ç‡çš„å®éªŒå:
- æ£€æŸ¥ `foggytcp2/results/mathis_data.csv` æ˜¯å¦æ­£ç¡®å†™å…¥
- éªŒè¯ååé‡å€¼æ˜¯å¦åœ¨åˆç†èŒƒå›´å†… (ä¾‹å¦‚: 0.1 - 10 Mbps)
- å¦‚å‘ç°å¼‚å¸¸,æŒ‰ Ctrl+C ä¸­æ­¢,æ£€æŸ¥ç½‘ç»œé…ç½®

#### 3.3 å®éªŒå®Œæˆåæ¸…ç†
```bash
# æ¸…ç†ç½‘ç»œå‘½åç©ºé—´
cd /home/serennan/work/algo2/foggytcp2/scripts
sudo ./cleanup_netns.sh
```

---

### é˜¶æ®µ 4: æ•°æ®åˆ†æä¸å¯è§†åŒ– (é¢„è®¡ 1 å°æ—¶)

#### 4.1 è¿è¡Œåˆ†æè„šæœ¬
```bash
cd /home/serennan/work/algo2/foggytcp2/scripts
python analyze_mathis.py
```

**è¾“å‡ºå†…å®¹**:
- å›å½’å‚æ•° (æ–œç‡ã€æˆªè·)
- å¸¸æ•° C çš„å€¼
- RÂ² å†³å®šç³»æ•°
- çš®å°”é€Šç›¸å…³ç³»æ•°åŠæ˜¾è‘—æ€§
- ç”Ÿæˆå›¾è¡¨æ–‡ä»¶: `../results/mathis_plot.png`

#### 4.2 ç»“æœéªŒè¯
- C å€¼ç†è®ºèŒƒå›´: 0.5 - 2.0 (æ ¹æ®æ–‡çŒ®)
- RÂ² åº”è¯¥ > 0.8 è¡¨ç¤ºè‰¯å¥½æ‹Ÿåˆ
- çš®å°”é€Š r åº”è¯¥ > 0.9 è¡¨ç¤ºå¼ºç›¸å…³

---

### é˜¶æ®µ 5: æŠ¥å‘Šæ’°å†™ (é¢„è®¡ 1-2 å°æ—¶)

#### 5.1 æ›´æ–°å®éªŒæŠ¥å‘Š

åœ¨ `/home/serennan/work/algo2/å®éªŒæŠ¥å‘Šä¸ç®—æ³•.md` ä¸­è¡¥å……ä»¥ä¸‹å†…å®¹:

**ç¬¬ä¸€éƒ¨åˆ†:Dr. Matt Mathis å‡è®¾éªŒè¯**

##### 5.1.1 å®éªŒè®¾ç½®
```markdown
### å®éªŒè®¾ç½®

#### ç½‘ç»œå‚æ•°
- å¸¦å®½: 10 Mbps
- RTT: 40 ms (å•å‘å»¶è¿Ÿ 20 ms)
- ä¸¢åŒ…ç‡: 0.01%, 0.05%, 0.1%, 0.5%, 1%, 2%, 5%

#### æµ‹è¯•é…ç½®
- æµ‹è¯•æ–‡ä»¶å¤§å°: 5 MB
- æ¯ä¸ªä¸¢åŒ…ç‡é‡å¤: 10 æ¬¡
- æ€»å®éªŒæ¬¡æ•°: 70 æ¬¡
- MSS: 1360 å­—èŠ‚
```

##### 5.1.2 å®éªŒæ•°æ®è¡¨æ ¼
```markdown
### å®éªŒæ•°æ®

| ä¸¢åŒ…ç‡ p | 1/âˆšp | å¹³å‡ååé‡ (Mbps) | æ ‡å‡†å·® | æœ€å°å€¼ | æœ€å¤§å€¼ |
|---------|------|------------------|--------|--------|--------|
| 0.01%   | 100  | X.XX             | X.XX   | X.XX   | X.XX   |
| ...     | ...  | ...              | ...    | ...    | ...    |
```

##### 5.1.3 çº¿æ€§å›å½’ç»“æœ
```markdown
### çº¿æ€§å›å½’åˆ†æ

#### å›å½’æ–¹ç¨‹
throughput = {slope} Ã— (1/âˆšp) + {intercept}

#### å¸¸æ•° C çš„è®¡ç®—
æ ¹æ®å…¬å¼ throughput = (MSS/RTT) Ã— (C/âˆšp)ï¼Œæˆ‘ä»¬æœ‰:
- æ–œç‡ slope = (MSS/RTT) Ã— C
- C = slope Ã— RTT / MSS
- C = {slope} Ã— 0.04 / (1360/1e6)
- **C = {C_value}**

#### æ‹Ÿåˆä¼˜åº¦
- RÂ² (å†³å®šç³»æ•°): {r_squared}
- æ ‡å‡†è¯¯å·®: {std_err}
```

##### 5.1.4 ç›¸å…³æ€§åˆ†æ
```markdown
### çš®å°”é€Šç›¸å…³ç³»æ•°

- **çš®å°”é€Šç›¸å…³ç³»æ•° r**: {pearson_r}
- **P å€¼**: {p_value}
- **æ˜¾è‘—æ€§**: {æ˜¯/å¦æ˜¾è‘—} (Î± = 0.05)

ç›¸å…³ç³»æ•°è§£é‡Š:
- |r| > 0.9: å¼ºç›¸å…³
- 0.7 < |r| â‰¤ 0.9: ä¸­ç­‰ç›¸å…³
- |r| â‰¤ 0.7: å¼±ç›¸å…³
```

##### 5.1.5 å®éªŒå›¾è¡¨
```markdown
### å®éªŒç»“æœå¯è§†åŒ–

![Mathis å‡è®¾éªŒè¯](foggytcp2/results/mathis_plot.png)

**å›¾è¯´æ˜**:
- è“è‰²æ•£ç‚¹: 70 æ¬¡å®éªŒçš„åŸå§‹æ•°æ®ç‚¹
- æ©™è‰²æŠ˜çº¿: æ¯ä¸ªä¸¢åŒ…ç‡ä¸‹çš„å¹³å‡ååé‡
- çº¢è‰²è™šçº¿: çº¿æ€§å›å½’æ‹Ÿåˆçº¿
```

##### 5.1.6 ç»“è®ºä¸è®¨è®º
```markdown
### ç»“è®º

#### å‡è®¾éªŒè¯ç»“æœ
åŸºäºå®éªŒæ•°æ®,æˆ‘ä»¬å¾—å‡ºä»¥ä¸‹ç»“è®º:

1. **C å€¼**: å®éªŒæµ‹å¾— C â‰ˆ {C_value}
2. **ç›¸å…³æ€§**: 1/âˆšp ä¸ååé‡çš„çš®å°”é€Šç›¸å…³ç³»æ•°ä¸º {pearson_r}
3. **å‡è®¾æ”¯æŒåº¦**: {å¼ºçƒˆæ”¯æŒ/éƒ¨åˆ†æ”¯æŒ/ä¸æ”¯æŒ} Dr. Mathis å‡è®¾

#### ç†ç”±åˆ†æ
- çº¿æ€§æ‹Ÿåˆçš„ RÂ² å€¼ä¸º {r_squared}ï¼Œè¡¨æ˜ {è‰¯å¥½/ä¸€èˆ¬/è¾ƒå·®} çš„çº¿æ€§å…³ç³»
- ç›¸å…³ç³»æ•° {é«˜äº/ä½äº} 0.9ï¼Œè¯´æ˜ {å¼º/å¼±} ç›¸å…³æ€§
- å¸¸æ•° C å€¼ {ç¬¦åˆ/ä¸ç¬¦åˆ} ç†è®ºé¢„æœŸèŒƒå›´ (0.5-2.0)

#### è¯¯å·®æ¥æºåˆ†æ
å¯èƒ½çš„è¯¯å·®æ¥æºåŒ…æ‹¬:
1. ç½‘ç»œç¯å¢ƒæ³¢åŠ¨(å³ä½¿ä½¿ç”¨ tcconfig ä»æœ‰ç³»ç»Ÿçº§æŠ–åŠ¨)
2. æµ‹é‡ç²¾åº¦é™åˆ¶(æ¯«ç§’çº§è®¡æ—¶)
3. ç¼ºå°‘è¶…æ—¶é‡ä¼ å¯¼è‡´éƒ¨åˆ†å®éªŒå¡ä½
4. ç¼“å†²åŒºæ’é˜Ÿå»¶è¿Ÿçš„å½±å“
5. å¿«é€Ÿæ¢å¤æœºåˆ¶çš„å®ç°ç»†èŠ‚å·®å¼‚

#### æ”¹è¿›å»ºè®®
1. å¢åŠ é‡å¤æ¬¡æ•°ä»¥å‡å°‘éšæœºè¯¯å·®
2. ä½¿ç”¨æ›´é•¿çš„æµ‹è¯•æ–‡ä»¶ä»¥æé«˜æ—¶é—´æµ‹é‡ç²¾åº¦
3. åœ¨æ›´ç¨³å®šçš„ç½‘ç»œç¯å¢ƒ(å¦‚è™šæ‹Ÿæœºç½‘ç»œ)ä¸­æµ‹è¯•
4. å®ç°è¶…æ—¶é‡ä¼ ä»¥é¿å…å¡æ­»æƒ…å†µ
```

---

## äº”ã€é¢„æœŸäº§å‡º

### 5.1 ä»£ç æ–‡ä»¶
- âœ… `foggytcp2/scripts/setup_netns.sh` - ç½‘ç»œå‘½åç©ºé—´è®¾ç½®è„šæœ¬
- âœ… `foggytcp2/scripts/cleanup_netns.sh` - ç½‘ç»œå‘½åç©ºé—´æ¸…ç†è„šæœ¬
- âœ… `foggytcp2/scripts/experiment_mathis.py` - å®éªŒæ‰§è¡Œè„šæœ¬ (å·²é€‚é…ç½‘ç»œå‘½åç©ºé—´)
- `foggytcp2/scripts/analyze_mathis.py` - æ•°æ®åˆ†æè„šæœ¬
- `foggytcp2/testdata/test_1mb.bin` - æµ‹è¯•æ–‡ä»¶ (1MB)

### 5.2 æ•°æ®æ–‡ä»¶
- `foggytcp2/results/mathis_data.csv` - åŸå§‹å®éªŒæ•°æ®
- `foggytcp2/results/mathis_summary.txt` - ç»Ÿè®¡æ‘˜è¦

### 5.3 å›¾è¡¨æ–‡ä»¶
- `foggytcp2/results/mathis_plot.png` - å›å½’åˆ†æå›¾

### 5.4 æŠ¥å‘Šæ–‡æ¡£
- `å®éªŒæŠ¥å‘Šä¸ç®—æ³•.md` - æ›´æ–°åçš„å®Œæ•´æŠ¥å‘Š(åŒ…å«ç¬¬ä¸€éƒ¨åˆ†)

---

## å…­ã€æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|-----|------|---------|
| 1 | ç¯å¢ƒå‡†å¤‡ | 30 åˆ†é’Ÿ |
| 2 | è„šæœ¬å¼€å‘ | 2-3 å°æ—¶ |
| 3 | æ‰§è¡Œå®éªŒ | 1-2 å°æ—¶ |
| 4 | æ•°æ®åˆ†æ | 1 å°æ—¶ |
| 5 | æŠ¥å‘Šæ’°å†™ | 1-2 å°æ—¶ |
| **æ€»è®¡** | | **6-9 å°æ—¶** |

---

## ä¸ƒã€é£é™©ä¸åº”å¯¹

### 7.1 å¯èƒ½é‡åˆ°çš„é—®é¢˜

#### é—®é¢˜ 1: ç½‘ç»œå‘½åç©ºé—´ä¸å­˜åœ¨ â­ **æ–°å¢**
**ç°è±¡**: å®éªŒè„šæœ¬æŠ¥é”™ "ç½‘ç»œå‘½åç©ºé—´æœªåˆ›å»º"

**åŸå› **: æœªè¿è¡Œ `setup_netns.sh` æˆ–å‘½åç©ºé—´è¢«æ„å¤–åˆ é™¤

**åº”å¯¹**:
```bash
# é‡æ–°åˆ›å»ºç½‘ç»œå‘½åç©ºé—´
cd /home/serennan/work/algo2/foggytcp2/scripts
sudo ./setup_netns.sh

# éªŒè¯
ip netns list  # åº”è¯¥çœ‹åˆ° ns_server å’Œ ns_client
sudo ip netns exec ns_client ping -c 3 10.0.1.1  # æµ‹è¯•è¿é€šæ€§
```

#### é—®é¢˜ 2: ç¨‹åºå¡ä½ä¸åŠ¨
**åŸå› **: æ–‡æ¡£æç¤º"ç”±äºç¼ºå°‘è¶…æ—¶é‡ä¼ ,æœ‰æ—¶ç¨‹åºå¯èƒ½å¡ä½"

**åº”å¯¹**:
- âœ… è„šæœ¬å·²è®¾ç½®è¶…æ—¶æœºåˆ¶ (300 ç§’ = 5 åˆ†é’Ÿ)
- âœ… è¶…æ—¶åè‡ªåŠ¨å¼ºåˆ¶æ€æ­»è¿›ç¨‹å¹¶è®°å½•ä¸ºå¤±è´¥
- è®°å½•å¡ä½çš„ä¸¢åŒ…ç‡,åˆ†ææ˜¯å¦æœ‰è§„å¾‹

#### é—®é¢˜ 3: tcconfig éœ€è¦ sudo æƒé™
**è§£å†³æ–¹æ¡ˆ**: âœ… **å·²è§£å†³**
- è„šæœ¬ä¸­æ‰€æœ‰ tcconfig å‘½ä»¤å·²æ·»åŠ  `sudo` å‰ç¼€
- è¿è¡Œè„šæœ¬æ—¶ä½¿ç”¨ `sudo python3 experiment_mathis.py`
- (å¯é€‰) é…ç½® sudoers å…è®¸æ— å¯†ç æ‰§è¡Œä»¥é¿å…å¤šæ¬¡è¾“å…¥å¯†ç :
  ```bash
  sudo visudo
  # æ·»åŠ : yourusername ALL=(ALL) NOPASSWD: /usr/bin/ip, /usr/local/bin/tcset, /usr/local/bin/tcdel
  ```

#### é—®é¢˜ 4: ç«¯å£å ç”¨
**åº”å¯¹**:
- âœ… è„šæœ¬å·²åœ¨æ¯æ¬¡å®éªŒåæ·»åŠ  2 ç§’å»¶è¿Ÿ
- âœ… è¿›ç¨‹æ¸…ç†æœºåˆ¶ç¡®ä¿ server è¿›ç¨‹æ­£ç¡®ç»ˆæ­¢
- å¦‚ä»æœ‰é—®é¢˜,ä½¿ç”¨ `lsof -i :15441` æ£€æŸ¥ç«¯å£çŠ¶æ€å¹¶æ‰‹åŠ¨æ¸…ç†

#### é—®é¢˜ 5: æ•°æ®ç‚¹è¿‡äºåˆ†æ•£
**åº”å¯¹**:
- å¢åŠ é‡å¤æ¬¡æ•°(ä» 10 æ¬¡å¢åŠ åˆ° 20 æ¬¡)
- ä½¿ç”¨æ›´é•¿çš„æµ‹è¯•æ–‡ä»¶ (ä» 1MB å¢åŠ åˆ° 5MB)
- âœ… ç½‘ç»œå‘½åç©ºé—´å·²éš”ç¦»ç¯å¢ƒ,å‡å°‘å¤–éƒ¨å¹²æ‰°

### 7.2 å¤‡ç”¨æ–¹æ¡ˆ

~~å¦‚æœè‡ªåŠ¨åŒ–è„šæœ¬å¼€å‘å›°éš¾,å¯é‡‡ç”¨**åŠè‡ªåŠ¨åŒ–æ–¹æ¡ˆ**~~
âœ… **å·²ä¸éœ€è¦**: è‡ªåŠ¨åŒ–è„šæœ¬å·²å®Œæˆå¹¶é€‚é…ç½‘ç»œå‘½åç©ºé—´

**å¦‚æœç½‘ç»œå‘½åç©ºé—´æ–¹æ¡ˆé‡åˆ°é—®é¢˜**,å¯ä»¥è€ƒè™‘:
1. **ä½¿ç”¨ Vagrant è™šæ‹Ÿæœº** (é¡¹ç›®å·²é…ç½® Vagrantfile)
   - ä¼˜ç‚¹: æœ€å‡†ç¡®çš„ç½‘ç»œå‚æ•°æ§åˆ¶
   - ç¼ºç‚¹: éœ€è¦å®‰è£… VirtualBox å’Œ Vagrant
2. **ä½¿ç”¨ Docker å®¹å™¨**
   - åˆ›å»ºä¸¤ä¸ªå®¹å™¨æ¨¡æ‹Ÿå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨
   - tcconfig åœ¨å®¹å™¨ç½‘ç»œæ¥å£ä¸Šè®¾ç½®å‚æ•°

---

## å…«ã€æŠ€æœ¯æ ˆæ€»ç»“

### 8.1 ç³»ç»Ÿå·¥å…·
- âœ… **Linux ç½‘ç»œå‘½åç©ºé—´ (Network Namespace)**: ç½‘ç»œç¯å¢ƒéš”ç¦»
- âœ… **tcconfig**: ç½‘ç»œå‚æ•°æ¨¡æ‹Ÿ (å»¶è¿Ÿã€å¸¦å®½ã€ä¸¢åŒ…ç‡)
- âœ… **veth pair**: è™šæ‹Ÿä»¥å¤ªç½‘æ¥å£å¯¹
- **Make**: C++ é¡¹ç›®ç¼–è¯‘
- **subprocess**: Python è¿›ç¨‹ç®¡ç†
- **ip netns**: ç½‘ç»œå‘½åç©ºé—´ç®¡ç†å·¥å…·

### 8.2 Python åº“
- **numpy**: æ•°å€¼è®¡ç®—
- **scipy**: ç»Ÿè®¡åˆ†æä¸å›å½’
- **matplotlib**: æ•°æ®å¯è§†åŒ–
- **pandas**: æ•°æ®å¤„ç†
- **csv**: CSV æ–‡ä»¶è¯»å†™

### 8.3 å¼€å‘ç¯å¢ƒ
- Python 3.x (å»ºè®® 3.8+)
- Conda è™šæ‹Ÿç¯å¢ƒ
- Fish Shell

---

## ä¹ã€æ£€æŸ¥æ¸…å•

### å®éªŒå¼€å§‹å‰ç¡®è®¤
- [ ] âœ… FoggyTCP é¡¹ç›®ç¼–è¯‘æˆåŠŸ (`make foggy`)
- [ ] âœ… ç½‘ç»œå‘½åç©ºé—´å·²åˆ›å»º (`sudo ./setup_netns.sh`)
- [ ] âœ… ç½‘ç»œè¿é€šæ€§æµ‹è¯•é€šè¿‡ (`sudo ip netns exec ns_client ping 10.0.1.1`)
- [ ] âœ… tcconfig å·²å®‰è£…å¹¶å¯æ­£å¸¸ä½¿ç”¨
- [ ] âœ… Python ä¾èµ–å·²å®‰è£… (numpy, scipy, matplotlib, pandas)
- [ ] âœ… æµ‹è¯•æ–‡ä»¶å·²å‡†å¤‡ (`test_1mb.bin`)
- [ ] âœ… ç›®å½•ç»“æ„å·²åˆ›å»º (scripts, testdata, results)
- [ ] âœ… å…·æœ‰ sudo æƒé™
- [ ] âœ… å®éªŒè„šæœ¬å·²é€‚é…ç½‘ç»œå‘½åç©ºé—´

### å®éªŒè¿›è¡Œä¸­
- [ ] æ¯ä¸ªä¸¢åŒ…ç‡å®Œæˆ 10 æ¬¡é‡å¤
- [ ] CSV æ•°æ®å®æ—¶ä¿å­˜åˆ° `foggytcp2/results/mathis_data.csv`
- [ ] ç›‘æ§å¼‚å¸¸æƒ…å†µå¹¶è®°å½• (æˆåŠŸ/å¤±è´¥ç»Ÿè®¡)
- [ ] å®šæœŸæ£€æŸ¥æ•°æ®åˆç†æ€§ (ååé‡èŒƒå›´: 0.1 - 10 Mbps)
- [ ] è§‚å¯Ÿè¿›ç¨‹æ˜¯å¦æ­£å¸¸å¯åŠ¨å’Œç»ˆæ­¢

### å®éªŒå®Œæˆå
- [ ] æ•°æ®å®Œæ•´æ€§æ£€æŸ¥ (70 æ¡è®°å½•)
- [ ] æ¸…ç†ç½‘ç»œå‘½åç©ºé—´ (`sudo ./cleanup_netns.sh`)
- [ ] å›å½’åˆ†ææˆåŠŸæ‰§è¡Œ
- [ ] å›¾è¡¨ç”Ÿæˆæ¸…æ™°å¯è¯»
- [ ] æŠ¥å‘Šå†…å®¹å®Œæ•´
- [ ] ç»“è®ºæœ‰ç†æœ‰æ®

---

## åã€å‚è€ƒæ–‡çŒ®

1. Mathis, M., Semke, J., Mahdavi, J., & Ott, T. (1997). *The macroscopic behavior of the TCP congestion avoidance algorithm*. ACM SIGCOMM Computer Communication Review, 27(3), 67-82.
   - é“¾æ¥: https://dl.acm.org/doi/10.1145/263932.264023

2. TCP Reno æ‹¥å¡æ§åˆ¶ç®—æ³•è¯¦è§£
3. tcconfig ä½¿ç”¨æ–‡æ¡£: https://github.com/thombashi/tcconfig

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-18
**æœ€åæ›´æ–°**: 2025-11-18
